<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Metagenomic Data • iSEEtree</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Metagenomic Data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">iSEEtree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/iSEEtree.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/metagenomic_data.html">Metagenomic Data</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/microbiome/iSEEtree/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Metagenomic Data</h1>
                        <h4 data-toc-skip class="author">Giulio
Benedetti</h4>
            <address class="author_afil">
      University of
Turku<br><a class="author_email" href="mailto:#"></a><a href="mailto:giulio.benedetti@utu.fi" class="email">giulio.benedetti@utu.fi</a>
      </address>
                  
            <h4 data-toc-skip class="date">3 October 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/microbiome/iSEEtree/blob/tutorial/vignettes/metagenomic_data.Rmd" class="external-link"><code>vignettes/metagenomic_data.Rmd</code></a></small>
      <div class="hidden name"><code>metagenomic_data.Rmd</code></div>

    </div>

    
    
<p>Here, we demonstrate how to fetch a metagenomic dataset from the <a href="https://www.ebi.ac.uk/about/teams/microbiome-informatics/mgnify/" class="external-link">MGnify
database</a> and explore it with the help of iSEEtree. For this purpose,
we will use a relatively large dataset obtained by shotgun metagenomic
sequencing of water samples from the Arctic Ocean during winter-spring
transition <span class="citation">(Sousa et al. 2019)</span>.</p>
<p>First, the following packages are imported to run the analysis.</p>
<p>Then, the Mgnify client is instantiated.</p>
<div class="sourceCode" id="section-cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Instantiate mgnify client</span></span>
<span><span class="va">mg</span> <span class="op">&lt;-</span> <span class="fu">MgnifyClient</span><span class="op">(</span>useCache <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We search all samples from the study of interest, which has the
accession MGYS00001869.</p>
<div class="sourceCode" id="section-cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fetch sample accession numbers</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu">searchAnalysis</span><span class="op">(</span><span class="va">mg</span>,</span>
<span>                          accession <span class="op">=</span> <span class="st">"MGYS00001869"</span>,</span>
<span>                          type <span class="op">=</span> <span class="st">"studies"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</span></span></code></pre>
<p>The samples are then fetched and combined into a TreeSE. This step
might take upto 10 minutes.</p>
<div class="sourceCode" id="section-cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fetch samples as TreeSE</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="fu">getResult</span><span class="op">(</span><span class="va">mg</span>, <span class="va">samples</span>,</span>
<span>                 get.taxa <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 get.func <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   |                                                                              |                                                                      |   0%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |===                                                                   |   4%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |=====                                                                 |   7%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |========                                                              |  11%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |==========                                                            |  15%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |=============                                                         |  19%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |================                                                      |  22%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |==================                                                    |  26%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |=====================                                                 |  30%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |=======================                                               |  33%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |==========================                                            |  37%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |=============================                                         |  41%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |===============================                                       |  44%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |==================================                                    |  48%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |====================================                                  |  52%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |=======================================                               |  56%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |=========================================                             |  59%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |============================================                          |  63%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |===============================================                       |  67%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |=================================================                     |  70%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |====================================================                  |  74%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |======================================================                |  78%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |=========================================================             |  81%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |============================================================          |  85%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |==============================================================        |  89%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |=================================================================     |  93%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |===================================================================   |  96%</span></span></code></pre>
<pre><code><span><span class="co">#&gt;   |                                                                              |======================================================================| 100%</span></span></code></pre>
<div class="sourceCode" id="section-cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View TreeSE</span></span>
<span><span class="va">tse</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; class: TreeSummarizedExperiment </span></span>
<span><span class="co">#&gt; dim: 4057 27 </span></span>
<span><span class="co">#&gt; metadata(0):</span></span>
<span><span class="co">#&gt; assays(1): counts</span></span>
<span><span class="co">#&gt; rownames(4057): 384552 1130548 ... 41722 5820</span></span>
<span><span class="co">#&gt; rowData names(8): Kingdom Phylum ... Species taxonomy_unparsed</span></span>
<span><span class="co">#&gt; colnames(27): MGYA00132764 MGYA00132765 ... MGYA00579273 MGYA00579274</span></span>
<span><span class="co">#&gt; colData names(64): analysis_pipeline.version analysis_experiment.type</span></span>
<span><span class="co">#&gt;   ... run_accession biome_string</span></span>
<span><span class="co">#&gt; reducedDimNames(0):</span></span>
<span><span class="co">#&gt; mainExpName: NULL</span></span>
<span><span class="co">#&gt; altExpNames(0):</span></span>
<span><span class="co">#&gt; rowLinks: NULL</span></span>
<span><span class="co">#&gt; rowTree: NULL</span></span>
<span><span class="co">#&gt; colLinks: NULL</span></span>
<span><span class="co">#&gt; colTree: NULL</span></span></code></pre>
<p>We apply different transformations to the counts assay, as certain
graphs provide more useful information and more aesthetically appealing
visualisation when created with, for example, relative abundance or
standardised assays.</p>
<div class="sourceCode" id="section-cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transform counts to relabundance</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mia/man/transformAssay.html" class="external-link">transformAssay</a></span><span class="op">(</span><span class="va">tse</span>,</span>
<span>                      method <span class="op">=</span> <span class="st">"relabundance"</span>,</span>
<span>                      assay.type <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Transform relabundance to CLR</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mia/man/transformAssay.html" class="external-link">transformAssay</a></span><span class="op">(</span><span class="va">tse</span>,</span>
<span>                      method <span class="op">=</span> <span class="st">"clr"</span>,</span>
<span>                      assay.type <span class="op">=</span> <span class="st">"relabundance"</span>,</span>
<span>                      pseudocount <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Standardise CLR</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mia/man/transformAssay.html" class="external-link">transformAssay</a></span><span class="op">(</span><span class="va">tse</span>,</span>
<span>                      method <span class="op">=</span> <span class="st">"standardize"</span>,</span>
<span>                      assay.type <span class="op">=</span> <span class="st">"clr"</span>,</span>
<span>                      MARGIN <span class="op">=</span> <span class="st">"features"</span>,</span>
<span>                      name <span class="op">=</span> <span class="st">"clr-z"</span><span class="op">)</span></span></code></pre></div>
<p>We estimate information on alpha and beta diversity so that it can be
accessed from the app.</p>
<div class="sourceCode" id="section-cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate alpha diversity</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mia/man/addAlpha.html" class="external-link">addAlpha</a></span><span class="op">(</span><span class="va">tse</span>,</span>
<span>                index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"coverage_diversity"</span>, <span class="st">"shannon_diversity"</span><span class="op">)</span>,</span>
<span>                assay.type <span class="op">=</span> <span class="st">"relabundance"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate beta diversity</span></span>
<span><span class="va">tse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runMDS.html" class="external-link">runMDS</a></span><span class="op">(</span><span class="va">tse</span>,</span>
<span>              FUN <span class="op">=</span> <span class="fu">vegan</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html" class="external-link">vegdist</a></span>,</span>
<span>              method <span class="op">=</span> <span class="st">"bray"</span>,</span>
<span>              ncomp <span class="op">=</span> <span class="fl">10</span>,</span>
<span>              assay.type <span class="op">=</span> <span class="st">"relabundance"</span><span class="op">)</span></span></code></pre></div>
<p>To prevent the column data table to take too much space, we remove
the two long variables that are causing the expansion. In principle, the
app can also run without this deletion.</p>
<div class="sourceCode" id="section-cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove long variables</span></span>
<span><span class="va">max_col_length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">tse</span><span class="op">)</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">tse</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">tse</span><span class="op">)</span><span class="op">[</span> , <span class="va">max_col_length</span> <span class="op">&lt;</span> <span class="fl">20</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">max_col_length</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Finally, the app is launched by passing the TreeSE object to
<code>iSEE</code>. After tuning the parameters for the different panels,
the app appears as illustrated by the image below.</p>
<div class="sourceCode" id="section-cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Launch app</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/iSEE.html">iSEE</a></span><span class="op">(</span><span class="va">tse</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="screenshots%2Fmetagenomic_data.png" width="100%"></p>
<p>To know more about how to explore big data with iSEE and iSEEtree,
check the related <a href="https://isee.github.io/iSEE/articles/bigdata.html" class="external-link">iSEE
article</a>.</p>
<div id="section-refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="section-ref-de2019diversity" class="csl-entry">
Sousa, António Gaspar G de, Maria Paola Tomasino, Pedro Duarte, Mar
Fernández-Méndez, Philipp Assmy, Hugo Ribeiro, Jaroslaw Surkont, et al.
2019. <span>“Diversity and Composition of Pelagic Prokaryotic and
Protist Communities in a Thin Arctic Sea-Ice Regime.”</span>
<em>Microbial Ecology</em> 78: 388–408. <a href="https://doi.org/10.1007/s00248-018-01314-2" class="external-link">https://doi.org/10.1007/s00248-018-01314-2</a>.
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Giulio Benedetti, Leo Lahti.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
